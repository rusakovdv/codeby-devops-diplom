# üèó Infrastructure & Monitoring CI/CD
---

## üì¶ –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
‚îú‚îÄ‚îÄ app/                   # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile         # Dockerfile –¥–ª—è —Å–æ–∑–¥–∞–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ go.mod
‚îÇ   ‚îî‚îÄ‚îÄ go.sum
‚îÇ   
‚îÇ
‚îú‚îÄ‚îÄ helm_charts/           
‚îÇ   ‚îî‚îÄ‚îÄ app/               # Helm chart –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îî‚îÄ‚îÄ terraform/        # Terraform-–∫–æ–¥ –¥–ª—è Yandex Cloud
‚îÇ
‚îú‚îÄ‚îÄ monitoring/           # Helm values –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îú‚îÄ‚îÄ loki/
‚îÇ   ‚îî‚îÄ‚îÄ promtail/
‚îÇ
‚îî‚îÄ‚îÄ .github/workflows/    # CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
```

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø–æ–ª–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å** –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ CI/CD.

---

## üèó –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ Object Storage bucket –≤ Yandex Cloud

Terraform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **remote backend (S3-compatible Object Storage)** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞—Ç—å bucket:

* –í Yandex Cloud ‚Üí Object Storage
* –í–∫–ª—é—á–∏—Ç—å **versioning**
* –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Service Account)

Bucket –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è terraform state**.

---

### 2Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Service Account –∏ –¥–æ—Å—Ç—É–ø–æ–≤

#### üîë 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ (CLI)

–°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–æ–ª–∏:

* `editor` –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ (vpc, compute, iam, storage)

–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞:

‚Üí [https://yandex.cloud/ru/docs/iam/operations/authentication/manage-authorized-keys#cli_1](https://yandex.cloud/ru/docs/iam/operations/authentication/manage-authorized-keys#cli_1)

–†–µ–∑—É–ª—å—Ç–∞—Ç:

* JSON-—Ñ–∞–π–ª —Å –∫–ª—é—á–æ–º Service Account

---

### 3Ô∏è‚É£ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Terraform

Terraform –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é backend (Object Storage)
* –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ provider Yandex Cloud
* –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º–æ–≥–æ –º–æ–¥—É–ª—è

–ó–∞–ø—É—Å–∫:

* –ª–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
* **—á–µ—Ä–µ–∑ GitHub Actions** (–æ—Å–Ω–æ–≤–Ω–æ–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å)

üìå Production-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ CI/CD**.
---

### 3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ kube config, –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ 

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ [cc—ã–ª–∫–µ](https://yandex.cloud/ru/docs/managed-kubernetes/operations/connect/create-static-conf)

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É –≤–∞–º –Ω–∞ —Ä—É–∫–∞—Ö –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É

---

### 4Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è monitoring stack:

  * Prometheus
  * Loki
  * Promtail

–î–µ–ø–ª–æ–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Helm + GitHub Actions**:

* –∞—Ç–æ–º–∞—Ä–Ω–æ (`--atomic`)
* —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (`--wait`)

---

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1Ô∏è‚É£ –°–±–æ—Ä–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –æ–±—Ä–∞–∑–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ Docker –∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –≤ Kubernetes.

–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞:

* üîß **–õ–æ–∫–∞–ª—å–Ω–æ** ‚Äî –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏
* ü§ñ **–ß–µ—Ä–µ–∑ GitHub Actions** ‚Äî –¥–ª—è dev / prod

---

### 2Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

CI/CD —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è:

| –°–æ–±—ã—Ç–∏–µ      | –î–µ–π—Å—Ç–≤–∏–µ               |
| ------------ | ---------------------- |
| PR ‚Üí main    | –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã           |
| Push ‚Üí dev   | –¢–µ—Å—Ç—ã + Docker build   |
| Tag `vX.Y.Z` | –¢–µ—Å—Ç—ã ‚Üí Build ‚Üí Deploy |

üìå **–î–µ–ø–ª–æ–π –≤ production –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ git-—Ç–µ–≥–∞**.

---

### 3Ô∏è‚É£ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ Kubernetes

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

* –°–æ–∑–¥–∞—Ç—å namespace
* –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å ConfigMap / Secrets
* –û–ø–∏—Å–∞—Ç—å ingress / service

–≠—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã:

* —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
* –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üåç –†–∞–±–æ—Ç–∞ —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (Terraform)

### üîÅ Workflow: `Terraform Plan & Apply (Yandex Cloud)`

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**

* Pull Request –≤ –≤–µ—Ç–∫—É `main`
* –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤:

  * `infrastructure/terraform/**`
  * `.github/workflows/infra-deploy.yml`

---

### üß© –≠—Ç–∞–ø—ã CI/CD

#### 1Ô∏è‚É£ Terraform Plan (PR stage)

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ PR:

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Terraform
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **provider mirror Yandex Cloud**
* –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è backend (S3 Object Storage)
* –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `terraform plan`
* –†–µ–∑—É–ª—å—Ç–∞—Ç:

  * –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è **–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º –≤ PR**
  * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç

üìå **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**

> –ü–æ–Ω—è—Ç—å *—á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è* –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

---

#### 2Ô∏è‚É£ Terraform Apply (production)

* –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ plan**
* –ü—Ä–∏–≤—è–∑–∞–Ω –∫ `environment: prod`
* –¢—Ä–µ–±—É–µ—Ç **manual approve** –≤ GitHub
* –í—ã–ø–æ–ª–Ω—è–µ—Ç:

```bash
terraform apply -auto-approve
```

### üîë –¢—Ä–µ–±—É–µ–º—ã–µ secrets

| Secret                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                 |
| ------------------------- | -------------------------- |
| `YC_SA_KEY_JSON`          | Service Account key (JSON) |
| `YC_CLOUD_ID`             | Cloud ID                   |
| `YC_FOLDER_ID`            | Folder ID                  |
| `YC_S3_ACCESS_KEY_ID`     | Object Storage access key  |
| `YC_S3_SECRET_ACCESS_KEY` | Object Storage secret key  |

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus / Loki / Promtail)

### üîÅ Workflow: `Deploy Monitoring Stack`

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**

* Pull Request –≤ `main`
* –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `monitoring/**`

---

### üîç –£–º–Ω—ã–π –¥–µ–ø–ª–æ–π –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `paths-filter`, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:

* –ò–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ `prometheus`
* –ò–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ `loki`
* –ò–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ `promtail`

–î–µ–ø–ª–æ–∏—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–º–µ–Ω—è–ª–æ—Å—å**.

---

### üöÄ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### Prometheus

* Helm chart: `kube-prometheus-stack`
* Namespace: `monitoring`
* ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç manual approve (environment: prod)**

#### Loki

* Helm chart: `grafana/loki`
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

#### Promtail

* Helm chart: `grafana/promtail`
* –î–µ–ø–ª–æ–∏—Ç—Å—è –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è:

  * promtail
  * loki
  * prometheus

---

### üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ—è

–ö–∞–∂–¥—ã–π Helm‚Äë–¥–µ–ø–ª–æ–π:

```bash
helm upgrade --install \
  --wait \
  --atomic \
  --timeout 10m
```

‚úî `--atomic` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
‚úî `--wait` ‚Üí –¥–µ–ø–ª–æ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å—ë Ready

---

## üöÄ –†–µ–ª–∏–∑–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ **GitFlow‚Äë–ø–æ–¥–æ–±–Ω–æ–π –º–æ–¥–µ–ª–∏** —Å —á—ë—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å—Ç–∞–¥–∏–π: **test ‚Üí build ‚Üí release ‚Üí deploy**.

### üå± –í–µ—Ç–∫–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

| –í–µ—Ç–∫–∞       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                    |
| ----------- | ------------------------------------------------------------- |
| `dev`       | –û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ß–∞—Å—Ç—ã–µ –∫–æ–º–º–∏—Ç—ã, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã, —Ñ–∏—á–∏ |
| `main`      | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≥–æ—Ç–æ–≤–æ–µ –∫ —Ä–µ–ª–∏–∑—É                        |
| `feature/*` | –ö—Ä–∞—Ç–∫–æ–∂–∏–≤—É—â–∏–µ –≤–µ—Ç–∫–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á                       |

---

### üîÑ CI/CD Workflow: `App CI/CD (Test ‚Üí Build ‚Üí Deploy)`

Workflow —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π:

#### 1Ô∏è‚É£ Pull Request –≤ `main`

–¢—Ä–∏–≥–≥–µ—Ä:

* `pull_request` ‚Üí `main`
* –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `app/**`, `helm/**`

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

* üß™ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è unit‚Äë—Ç–µ—Å—Ç—ã
* üê≥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker‚Äë–æ–±—Ä–∞–∑
* üè∑ –æ–±—Ä–∞–∑ —Ç–µ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `pr-<number>`
* ‚ùå –¥–µ–ø–ª–æ–π **–ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è**

üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:

> –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ —Å–±–æ—Ä–∫–∏ **–¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ main**

---

#### 2Ô∏è‚É£ Push –≤ `dev`

–¢—Ä–∏–≥–≥–µ—Ä:

* `push` ‚Üí `dev`

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

* üß™ —Ç–µ—Å—Ç—ã
* üê≥ —Å–±–æ—Ä–∫–∞ Docker‚Äë–æ–±—Ä–∞–∑–∞
* üè∑ —Ç–µ–≥ `dev`
* üì¶ –æ–±—Ä–∞–∑ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ `ghcr.io`

üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:

> –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–¥ **—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç**, –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ production

---

#### 3Ô∏è‚É£ Git tag `vX.Y.Z` (Release)

–¢—Ä–∏–≥–≥–µ—Ä:

* `git tag v1.2.3 && git push origin v1.2.3`

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

* üß™ —Ç–µ—Å—Ç—ã
* üê≥ —Å–±–æ—Ä–∫–∞ Docker‚Äë–æ–±—Ä–∞–∑–∞
* üè∑ —Ç–µ–≥–∏:

  * `1.2.3`
  * `latest`
  * `sha-<commit>`
* üöÄ –¥–µ–ø–ª–æ–π –≤ Kubernetes (`prod`)

üìå –≠—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±** –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ production.

---

### üè∑ –ü—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (SemVer)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Semantic Versioning**:

```
vMAJOR.MINOR.PATCH
```

| –í–µ—Ä—Å–∏—è  | –ö–æ–≥–¥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è             |
| ------- | ------------------------------- |
| `MAJOR` | breaking changes                |
| `MINOR` | –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –ª–æ–º–∞ |
| `PATCH` | –±–∞–≥—Ñ–∏–∫—Å—ã                        |

–ü—Ä–∏–º–µ—Ä:

```bash
git tag v1.3.0
git push origin v1.3.0
```

---

### üì¶ Docker‚Äë—Ç–µ–≥–∏

–û–±—Ä–∞–∑—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ `ghcr.io` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ç–µ–≥–∞–º–∏:

| –°—Ü–µ–Ω–∞—Ä–∏–π | –¢–µ–≥               |
| -------- | ----------------- |
| PR       | `pr-42`           |
| Dev      | `dev`             |
| Release  | `1.2.3`, `latest` |
| –í—Å–µ–≥–¥–∞   | `sha-<commit>`    |

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* —Ç–æ—á–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –¥–µ–ø–ª–æ–π
* –±—ã—Å—Ç—Ä–æ –¥–µ–ª–∞—Ç—å rollback
* –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `latest` –≤ Helm

---

### üöÄ –î–µ–ø–ª–æ–π –≤ Kubernetes

–î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Helm:

* namespace: `default`
* —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: `helm upgrade --install`
* —Ñ–ª–∞–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```bash
--wait
--atomic
--timeout 5m
```

‚úî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
‚úî –¥–µ–ø–ª–æ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ Ready‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–∏

---



